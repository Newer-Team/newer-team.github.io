<!DOCTYPE html>
<html class="no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Hero of Law</title>
	<meta name="description" content="Home of Hero of Law, a very unique OoT mod.">
	<meta name="viewport" content="width=980, user-scalable=yes">
	<link rel="icon" type="image/png" href="img/favicon.png">

	<link href='https://fonts.googleapis.com/css?family=Titillium+Web:400,700' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=VT323' rel='stylesheet' type='text/css'> 
	<link rel="stylesheet" href="../css/normalize.min.css">
	<link rel="stylesheet" href="../css/960.css">
	<link rel="stylesheet" href="../css/hol.css">
	<link rel="stylesheet" href="../css/lightbox.css">

	<script src="../js/vendor/modernizr-2.6.2.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script src="../js/lightbox.js"></script>
    
    <script src="../js/webpatcher/libpatch.js"></script>
</head>
<body id='homepage'>
	<div>
		<header>
			<img src='img/logo.png' id='logo' alt='Hero of Law Logo'>
		</header>
		<a href="/"><img src='../images/home.png' id='homebutton'></a>
		<div id='mainWrapper'>

			<div id='intro' class='container_12'>

                <br>
				<section id='introBlurb' class='grid_12'>
					<b>Hero of Law</b> is a crossover mod for <b>The Legend of Zelda: Ocarina of Time</b><br>that puts Link into the shoes of a defence attorney!<br>
				</section>

				<div class='spaceOutABit'></div>

				<section id='downloadSection' class='grid_12'>
					<h2>Get Hero of Law!</h2>
					<h3>Current release: <b>1.00</b><br></h3>
                    <button id='patch-button' class='blueButton'>Patch ROM</button>
                    <br><small>Powered by shygoo's <a target='_blank' href='https://github.com/shygoo/webpatcher'>Web Patcher & Swapper</a></small>

					<div class="downloadNote">
						You need to provide an <i>Ocarina of Time</i> N64 ROM or Wii Virtual Console WAD file.
                        <br><br>
                        <b>This mod is playable on real Nintendo 64 hardware, as well as most emulators. Compatibility information and more can be found in the <a href='./docs/readme.pdf'>readme</a> and <a href='./docs/changelog.pdf'>changelog</a>.</b>
                        <br>
                        <small>For offline use, you can also download the <a href='https://mega.nz/file/GnxEHbRQ#QxSMqbWqStJReV5saPJCyoeB3974dKPWBkIK16sHnlk'>raw patch data</a>.</small>
					</div>
				</section>

				<div class='spaceOutABit'></div>

				<div id='trailer' class='grid_12'>
					<h2>Check out the trailer!</h2>
					<div class='video-container'>
						<iframe width="600" height="336" src="https://www.youtube-nocookie.com/embed/VOdY_7dKNSU" frameborder="0" allowfullscreen></iframe>
					</div>
					<div id='findUsOnYT'>
						See more videos on <a href='https://www.youtube.com/@newerteam'><b>our YouTube channel</b></a>
					</div>
				</div>

				<div class='clear'></div>
			</div>

			<div >
				<h2>Screenshots</h2>
				<div id='screenshotCarousel'>
					<a rel='lightbox[newer]' href='img/screens/1.png'><img src='img/screens/th1.png' alt='Screenshot'></a>
					<a rel='lightbox[newer]' href='img/screens/2.png'><img src='img/screens/th2.png' alt='Screenshot'></a>
					<a rel='lightbox[newer]' href='img/screens/3.png'><img src='img/screens/th3.png' alt='Screenshot'></a>
					<a rel='lightbox[newer]' href='img/screens/4.png'><img src='img/screens/th4.png' alt='Screenshot'></a>
					<a rel='lightbox[newer]' href='img/screens/5.png'><img src='img/screens/th5.png' alt='Screenshot'></a>
					<a rel='lightbox[newer]' href='img/screens/6.png'><img src='img/screens/th6.png' alt='Screenshot'></a>
                    <a rel='lightbox[newer]' href='img/screens/7.png'><img src='img/screens/th7.png' alt='Screenshot'></a>
				</div>
			</div>

            <div class='spaceOutABit'></div>

			<div id='introLowerRow' class='container_12'>
				<h2>Stuck?</h2>
                <div id='introWalkthrough'>
                    Consult the spoiler-free walkthrough available <a href='./docs/walkthrough.pdf'>here</a>.
                </div>
			</div>
            
            <div class='spaceOutABit'></div>

            <div id='introLowerRow' class='container_12'>
                <section id='introSoundtrack'>
                    <h2>Get the Soundtrack!</h2>
                    <p>Want to listen to our tunes even when you're not playing Hero of Law? Click the button below to download the game's <b>full soundtrack</b>!</p>
                </section>
                <div class='clear'></div>
                <div class='spaceOutABit'></div>
                <div id='introMakeYourOwnButton' class='grid_12 clearfix centeredButtonGroup'>
                    <a href='https://mega.nz/file/6vYFxBBY#BbVraMYYAXypMEU5jPY_FwHe0tJgwnL0jJdclp2MaSA' class='blueButton'>Download (MP3)</a>
                    <div id='dlSoundtrackInfo'>
                        <b>Download size:</b> 129 MB &middot; <b>Format:</b> MP3 (320kbps)
                        <br><br>
                        Also available <a href='https://mega.nz/file/67RFAbZJ#4W9xr-VUk0hknVXCo-8jRWWG1u4DKQ5ZK9FOw8OCFy4'>in FLAC format</a>, for you audiophiles out there.
                        <br>
                        <small>(<b>Download size:</b> 521 MB)</small>
                        <br><br>
                        The music is also uploaded to <a href='https://www.youtube.com/@NewerTeamMusic'>YouTube</a>.
                    </div>
                </div>
            </div>

			<footer id='mainFooter'>
				This website and its content are protected by international copyright law. This website and its content may not be copied, published, distributed, downloaded or otherwise stored, transmitted or converted, in any form or by any means, electronic or otherwise, without the prior written permission of the copyright owner. Link, Zelda, Impa, Ganondorf, and all related characters are Â© Nintendo, and are not under the copyright of this site. All other copyrights are the property of their respective owners.
			</footer>
		</div>
	</div>
    <script>
var patches = {
    // adler32 checksums
    0xe9b6fb6c: "patches/CZLE_1.0.xdelta",
    0x588307fb: "patches/CZLE_1.1.xdelta",
    0xc0940244: "patches/CZLE_1.2.xdelta",
    0x7e8ffb71: "patches/CZLJ_1.0.xdelta",
    0xed4d0800: "patches/CZLJ_1.1.xdelta",
    0x556d0249: "patches/CZLJ_1.2.xdelta",
    0x14956656: "patches/NZLP_1.0.xdelta",
    0x472decc1: "patches/NZLP_1.1.xdelta",
    0xf8e2da97: "patches/NACE01.xdelta",
    0xcb78e464: "patches/NACP01.xdelta",
    0x6c906279: "patches/NACJ01.xdelta",
    0x5d0294bd: "patches/zlj_f_1.0.xdelta",
    0x200e5ab6: "patches/zlj_f_1.1.xdelta",
    0x4c02d72e: "patches/zle_f.xdelta",
    0xd34dff34: "patches/zlp_f.xdelta",
    0x338e4bef: "patches/urazlj_f.xdelta",
    0x6b5149bf: "patches/urazle_f.xdelta",
    0x1d6fd0bc: "patches/urazlp_f.xdelta"
};
var patchButton = document.getElementById("patch-button");

// adler32 function subject to MIT license at
// https://newerteam.com/js/webpatcher/LICENSE.md
// Copyright (c) 2024 shygoo
function adler32(arr, offs, size)
{
    var a = 1, b = 0;

    for(var i = 0; i < size; i++)
    {
        a = (a + arr[offs + i]) % 65521;
        b = (b + a) % 65521;
    }

    return ((b << 16) | a) >>> 0;
}

function calcChecksum(arrayBuffer)
{
    var arr = new Uint8Array(arrayBuffer);
    return adler32(arr, 0, arr.length);
}

// swapN64Rom function subject to MIT license at
// https://newerteam.com/js/webpatcher/LICENSE.md
// Copyright (c) 2024 shygoo
function swapN64Rom(sourceData)
{
    romdv = new DataView(sourceData);
    var word = romdv.getUint32(0x00000000);
    
    switch(word)
    {
    case 0x37804012:
        for(var i = 0; i < romdv.byteLength; i += 2)
        {
            romdv.setUint16(i, romdv.getUint16(i, true));
        }
        break;
    case 0x40123780:
        for(var i = 0; i < romdv.byteLength; i+= 4)
        {
            romdv.setUint32(i, romdv.getUint32(i, true));
        }
        break;
    case 0x80371240:
        // ROM already uses Z64 byte ordering
    }
    
    return romdv.buffer;
}

document.getElementById("patch-button").addEventListener("click", () => {
    var input = document.createElement("input");
    input.type = "file";
    input.accept = ".z64,.n64,.v64,.wad";
    input.onchange = () => {
        var file = input.files[0];
        if (!file) return;

        var reader = new FileReader();
        reader.onload = async () => {
            var sourceData = swapN64Rom(reader.result);
            var checksum = calcChecksum(sourceData);

            var patchPath = patches[checksum];
            if (!patchPath)
            {
                alert("Unknown file. Please ensure you selected a valid Ocarina of Time N64 ROM or Wii Virtual Console WAD.");
                return;
            }
      
            patchButton.textContent = "Patching...";
            patchButton.disabled = true;

            var patchRes = await fetch(patchPath);
            if (!patchRes.ok) throw new Error(`HTTP ${patchRes.status}: ${patchRes.statusText}`);
            var patchData = await patchRes.arrayBuffer();
   
            applyPatchAsync(sourceData, patchData, {
                onpatchend: (targetData) => {
                    var ext = file.name.split('.').pop();
                    if (ext == "n64" || ext == "v64") ext = "z64";
                    var outName = "HeroOfLaw." + ext;
                    saveAs(outName, targetData);
                    
                    patchButton.textContent = "Patch ROM";
                    patchButton.disabled = false;
                },
                
                onerror: (message) => alert("Error: " + message + "\n\n" + "See console output for more information."),
            });
        };

        reader.readAsArrayBuffer(file);
    };
    input.click();
});

// saveAs function subject to MIT license at
// https://newerteam.com/js/webpatcher/LICENSE.md
// Copyright (c) 2024 shygoo
function saveAs(filename, data)
{
    console.log('saving ' + filename + '...')

    var blob = new Blob([data], {type: 'octet/stream'});
    var url = window.URL.createObjectURL(blob);

    if(navigator && navigator.msSaveBlob)
    {
        console.log("using msSaveBlob...");
        navigator.msSaveBlob(blob, filename);
    }
    else
    {
        var a = document.createElement('a');
        a.style = "display: none";
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        try
        {
            a.click();
        }
        catch(e)
        {
            console.error(e);
            console.log('failed to save file');
        }
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
    }
}
    </script>
</body>
</html>
